\documentclass{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{bm}
\usepackage{fancyvrb}


\author{Sigrid Videm}
\title{Electrodiffusion}

\begin{document}

\maketitle


\section{Abstract} 
\tableofcontents % for a table of contents


\section{Introduction}
All of our thougths, feelings and actions are a complex ensemble of electrical signals in the brain. The signals are generated and transported via specialized cells, the neurons. The neuroscientists way of understanding our brain, is to measure aspects of these electrical signals. For some cells, it is possible to measure the variations in the electric potential inside the cell. In the 1950's Hodgkin and Huxley did pioneering work on this field, laying the foundation of our current understanding of the neuron by performing in vitro experiments on single neurons. Now, the interaction of neurons in large networks is a major thing. Understanding such networks give us deeper insight in processes like learning, sleep and the recovery after brain damage. It helps us understand mental illnesses and age-related mental disorders. To understand the functioning of networks, in vivo measurements are favourable. Here, both invasive and non-invasive methods are used. The benefits of the non-invasive methods are obvious, but for a detailed study of the neuronal signalling, measurements from within the skull are required.  One common technique is to insert electrodes into the brain, and measure the electrical potential outside the neurons, in what is called the extracellular space. How to interpret these measurements, and what kind of neural activity we find the traces of, is a research area with many branches. 

The extracellular potentials are varying with time, and an analysis of the signals in terms of the frequencies is advantageous when it comes to finding connections between the measured signal and the behaviour of the neurons. One way to represent the signal in terms of the frequency is to find the Power Spectrum Density of the signal (PSD).  The Local Field Potential (LFP) is defined as the low-frequency part of the extracellular potential recorded by an extracellular electrode inserted into the brain. The theory of Current Source Density (CSD) relates the LFPs to what is going on inside the neurons. The essence of CSD theory is that an extracellular potential must be caused by currents going into or out of cells, and that the currents in the extracellular space are field currents alone, that is, they are caused by potential differences. 

Neuronal activity involves ionic exchange with the extracellular space, which might change the ionic concentration in the vicinity of the neurons, thereby producing an ionic concentration gradient. When there is a concentration gradient, there might also be diffusion. Because ions carry charge, ionic diffusion will cause a diffusive current. In standard CSD theory, the diffusive currents are neglected. Resent studies done by Gratiy et al. and Halnes et al. suggests that for large concentration gradients the diffusive currents must be accounted for. 

Gratiy et al.(Gratiy2017,) gives the mathematical framework for the relationship between electric currents through the neural membrane and the extracellular potential. They argue that the diffusion current can contribute to the CSD of the extracellular potential at low, but still measurable frequencies. The estimate on the effects of extracellular diffusion on the LFP recordings was done with data from two independent experiments. First, recorded extracellular potential in vivo from the mouse primary visual cortex was used for estimating the CSD under the assumption that transmembrane currents were the sole contributors to the extracellular poten-
tial. Then, extracellular $K^+$ transients in the mammalian cortex from previously published data was used to estimate the apparent CSD resulting from diffusion. 

In my work, I will dig deeper into this matter. I am going use LFPs and ionic concentrations from previously published experiments. I will use the ionic concentrations profiles in a simulation of the diffusion potential, and compare the diffusion potential to the LFPs found experimentally. My work differs from that of Gratiy et al. in that Gratiy et al. have used the initial K+ profile to estimate the apparent CSD resulting from diffusion, and then assumed an exponential decay of this CSD. I am going to model the diffusion potential itself. 

The modelling of the diffusion potential is previously done by Halnes et al. (*reference*). They have simulated the neurodynamics of 10 pyramidal cells centred at the same depth level of the tissue, and the extracellular potential and the transmembrane output of all ionic species were recorded. Then  dynamics of ionic concentration were computed with the KNP-formalism *reference*. Then, power spectrum densities were calculated. They concluded that the diffusive currents had no impact on the fast temporal scale. On the slow temporal scale, however, the diffusive currents induced shifts in the extracellular potentials, and changed the power spectra of local field potentials. Halnes et al. have two proposals. 1) The simplified decoupled model illustrated that the ECS diffusion gave rise to a $1/f^2$ contribution to the PSD. 2) the crossing point between the PSD obtained from diffusive process alone and the PSD obtained from neurodynamics when no diffusion was included may serve as a crude estimate of the maximum frequencies for which diffusion can be expected to influence the PSD. 


This thesis is an attempt to answer the proposals of Halnes et al. I have modelled the extracellular diffusion by implementing a numerical scheme (*section*) for solving the 1D  Nerst--Planck equation (*section*). I have found recordings of extracellular ionic concentrations, and done a study of how to make ionic concentration profiles for more than one ion species when the data sets do not. I have used the ionic profiles to calculate the diffusion potential, and I have compared the PSD of the diffusion potential to the PSD of a recorded LFP. Contrary to the results of Gratiy et al and Halnes et al., I do not find reason to believe that non-pathological concentration gradients does produce a diffusion potential which affects the LFP. Some pathological conditions might give extracellular K+ concentrations which are 10 times larger. I have modelled the diffusion potential for such an extreme case, to see if diffusion might affect the LFP. 



****



If my results disconfirms these proposals, I conclude that the assumption of the volume conductor theory (diffusive currents are negligible) is valid. 
(I need to treat "model assumptions" seriously at some later stage)
Further study from Halnes2016: it is unclear whether the slow components of the PSD would be influenced by choice of population size and model dimensionality. Can I find anyone who have studied this???

Check this out: On the
other hand, several slower oscillatory patterns exist with their main
frequency component being below 1 Hz such as slow neocortical
rhythms and delta waves (Gloor et al., 1977; Buzsaki et al., 1988;
Steriade et al., 1993).


*****
My journey into the field of electrodiffusion started with the reading of Halnes2016 and Gratiy2017. I think these articles are a natural entrance to the work I will present in this thesis, and I will therefore try to outline the most relevant ideas in the following. In my work, I rely on experimental data for the ionic concentrations. Dietzel1982 provides good data sets, as well as an insight in how to construct models based on limited data sets. 


\section{Theory}
\subsection{Electroneutrality, the neuronal membrane and action potentials}
Information is conveyed from one place in the nervous system to another by electrical signals conducted along the axons, so-called Action Potentials (APs). (Purves et al.). The action potential is most often initiated in the axon hillock, which has has a specialized plasma membrane that contains large numbers of voltage-gated ion channels(newworldencyclopedia). The action potential travels down the axon, and through synapses, gives input, or stimuli, to the dendrites of other neurons. Depending on the amount of stimuli, the neuron might initiate/fire a new action potential. 
The neuronal membrane is the key to the initiating and transmission of action potentials. The membrane is a lipid bilayer with embedded proteins. Ionic channels and ionic pumps are such proteins. An ionic channel let ions move along their gradient, while ionic pumps use energy in the form of ATP molecules to move ions against their gradient. The work of the ionic pumps makes a concentration difference between the intracellular and the extracellular space. See table. The  channels in the neuronal membrane makes the membrane permeant to potassium ions, while almost impermeant to sodium ions. A membrane which is permeant to only one ion species gives rise to a separation of charge, caused by the diffusion of the permeant ions. The Goldman equation 
\begin{equation}
V_m = \frac{RT}{F}\ln \frac{P_K[K^+]_o + P_{Na}[Na^+]_o + P_{Cl}[Cl^-]_{i}}{P_K[K^+]_i + P_{Na}[Na^+]_i + P_{Cl}[Cl^-]_{o}}
\end{equation}
predicts the voltage across such a membrane, with the values of *table* it gives a voltage difference between the inside and the outside of the neuron of approximately -70 mV, and is depending on the permeability to K+ and Na+ (and other ions). This is the resting membrane potential of the neuron. The ion channels are voltage-dependent(there are MANY channels which are not voltage dependent, but they are not important here). If the potential becomes higher, the Na+ channels open, and the membrane becomes permeable to Na+, and the K+ channels close. As Na+ flows across the membrane, they take a positive charge with them, making the membrane potential even higher. The membrane is said to be depolarized. If the depolarization reaches a certain threshold, an action potential is generated.  When the K+ channels open again, the membrane potential quickly returns to its resting level, and the membrane is again impermeable to Na+. A consequence of this initiating of an action potential is transient Na+ influx and K+ efflux to the cell. Normally, these fluxes are considered so small that the do not change the baseline concentrations of *table*. In this project, I have studied cases where intense neuronal firing of action potentials produce deviations from the baseline concentrations. 

The resting membrane potential and the firing of action potentials rely on a separation of charge, and thereby a local deviation from electoneutrality. The separation of charge requires energy. The latter has a fundamental consequence. In a model of the movement of ions, if we cannot account for the energy needed to separate charge, we must assume the system to behave in an electroneutral way, that is, at every point in space the movement of an ion must be accompanied of the movement of another ion, so that the net charge going into or out of the point is zero. This can be done in two ways: the a cation moves together with an anion, or a cation is exchanged by another cation. 

\subsection{Layered structures in the brain}
(wikipedia about cortex facts)
 
The cerebral cortex is the largest part of the mammalian brain. It is has a sheet-like structure. The surface area and the thickness of the cortex depends on the animal species. In humans it has a area of 0.12 m2, and a thickness of 2.3 - 2.8 mm. The cortex is confined to the volume of the skull, in humans and other large mammals, the sheet is folded, giving the brain the characteristic appearance we recognize from the popular culture and textbooks, as illustrated in figure  \ref{fig:spongebob}.  The cortex has a laminar organization. See figure. Most of the cortex has six cellular layers. Each layer comprises more or less distinctive populations of cells based on their different densities, sizes, shapes, inputs and outputs. (Purves et al. ) Each cortical layer has a primary source of inputs a primary source of targets. Each layer is occupied with some specific types of neurons. For example, the internal pyramidal layer is mainly occupied with large pyramidal neurons with their axons travelling down, while the upper cortical area contains small pyramidal neurons an stellate neurons. The cortex is also divided into functional areas that serve various sensory, motor, and cognitive functions. As a consequence, one particular input, might give stimuli to one particular type of neurons, making a response that vary across the cortical depth, but is the same within this functional area. This behaviour encourages measurements of laminar profiles of the extracellular potentials and ionic concentration gradients.  


\begin{figure}[!tbp]
  \centering
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{spongebob.png}
  \end{minipage}
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{cortex.jpg}
  \end{minipage}  
   \caption{Left: Spongebob with his brain exposed, featuring the folded sheet-like structure of the cortex. Right: a schematic drawing of the human cortex and its functional areas.}
  \label{fig:spongebob}
\end{figure}



\subsection{Local Field Potentials}
The Local Field Potentials (LFP) is defined as the low-frequency part of the electrical potential recorded by an extracellular electrode
inserted into the brain. The LFP appears to predominantly reflect the synaptic inputs to the neurons, in contrast to the Multi Unit Activity (MUA) which is the high-frequency part of the potential and  which contains information about the firing of action potentials of a handful of the
surrounding neurons.  Current-source density (CSD) analysis of multiple LFP recordings across well-organized
layered neural structures such as cortex, cerebellum, and hippocampus allows for a more local measure of neural activity than the LFP which is easier to interpret in terms of the activity in the underlying neural circuits.
\subsection{What is electrodiffusion?}\ref{electrodiffusion}

Diffusion is a process caused by the random walk of particles when a concentration gradient is present. There will be a particle flux towards lower concentration. The flux is determined by the concentration gradient, but also by the diffusion coefficient of the particles. A high diffusion coefficient will even out the concentration gradient more rapidly. The concentration dynamics for a purely diffusive process is given by Fick's law:
\begin{equation}\label{eq:diff}
 \bm{J}_{diff,k} = - D_k\nabla c_k
\end{equation}
Where  $J_{diff,k}$ is the particle flux of ion species $k$, $D_k$ is the diffusion coefficient and $c_k$ is the concentration.

Electric migration is the process where electrically charged particles moves towards a lower potential. The flux is determined by the potential gradient, $\nabla \Phi$,  and the valence of the ions, $z$. 
\begin{equation}
\bm{J}_{field,k} = -\frac{D_kz_kF}{RT} c_k\nabla \Phi
\end{equation}
The temperature $T$ is considered constant in living things, $F$ is Faradays constant and $R$ is the gas constant. Combine these two processes, and we have the Nernst -- Planck relation:
 \begin{equation}\label{eq:nernst-planck}
\bm{J}_k = -\frac{D_k}{\lambda_n^2}\nabla c_k -\frac{D_k z_k}{\lambda_n^2 \Psi}c_k  \nabla \Phi
\end{equation}
where $D_k$ is the effective diffusion coefficient, $\lambda_n$ is the tortuosity factor, and $\Psi \equiv RT/F$.

The flux  of ion species $k$ is related to the change in concentration by the continuity equation. 

\begin{equation}
\frac{\partial c_k}{\partial t} = -\nabla \bm{J}_k
\end{equation}
which leads to a partial differential equation describing the relation between the change in concentration, the concentration gradient and the potential gradient.
 \begin{equation}\label{eq:el-diff}
\frac{\partial c_k}{\partial t}  = \frac{D_k}{\lambda_n^2}\nabla^2 c_k +\frac{D_k z_k}{\lambda_n^2 \Psi}\nabla c_k  \nabla \Phi
\end{equation}

Equation \ref{eq:el-diff} will be our protagonist, and I think it is wise to get to know it better before we continue. Consider a homogeneous solution with equal amounts of $Na^+$ and $Cl^-$. At some point in spacetime you increase the amount of both $Na^+$ and $Cl^-$. Then there is a gradient in $[Na^+]$ and $[Cl^-]$, and the concentrations will change with time to even out the difference. Two competing processes emerge:
\begin{enumerate}
\item The $Cl^-$ gradient even out faster because $Cl^-$ has a larger diffusion coefficient. 
\item If there is an electrical field, it will affect  $[Na^+]$ and $[Cl^-]$ in different way, because they got opposite charge.
\end{enumerate}

In the beginning, there is no electrical field. $Cl^-$ diffuses faster than $Na^+$, leaving a small positive charge in the point. See *figure* When there is a difference in charge, there is also an electrical field. The emerging electrical field slows down the $Cl^-$, and speeds up the $Na^+$. Because the field is created by the faster $Cl^-$, the field will increase slower an slower as the  the diffusion speed of the two ions become more equal. When the diffusion speeds are equal, there is no net movement of charge. Then, the electrical field is just large enough to keep the $Cl^-$ flux equal to the $Na^+$ flux. The field is what I will refer to as the diffusion potential. Previous studies(*reference*) have revealed that the diffusion potential is established within the first 10 ns. To model the ion dynamics and the potential for this period, is computationally expensive (and done by Andreas?). After the potential is established, the system is commonly assumed to be electroneutral. That is, apart from the small charge separation required for the diffusion potential, every point in space has zero net charge. 

$$\sum _k z_k c_k =0$$
The electroneutrality assumption will be an underlying assumption for the following, even though it is not strictly true. It makes us able to look for a quasi-stationary solution of equation \ref{eq:el-diff}, but, as we will see later on, the diffusion potential is decaying with time as the concentration gradients flattens out. 



The origin of the diffusion potential is the difference in the diffusion coefficient of the two ion species. If there were no difference, the ion species would diffuse with the exact same speed, all the time. Then, there would be no separation of charge to produce an electrical field. Based on this, I predict that the larger difference in diffusion coefficient, the larger is the diffusion potential. For the two-ion system described above, I argued that the ions diffuse with the same speed after the diffusion potential has been established. In section \ref{joint diffusion} I show that  it is possible to find a joint diffusion coefficient so that the system can be described by the diffusion equation ( equation  \ref{eq:diff}). The diffusion equation has analytical solutions. I have incorporated a solution of the diffusion equation in my thesis, because it makes me able to do an error analysis on the numerical scheme which I have used to solve   equation \ref{eq:el-diff}.



 


\subsection{Neuronal output and concentration gradients}
\subsubsection{Neuronal output and one-dimensional models}
Action potentials are generated by an ionic exchange between the neurons and the extracellular space. The $K^+$ concentration is higher inside the cell than it is outside, and the $Na^+$ concentration is lower inside. When an action potential is generated,  channels in the neural membrane open, so that $K^+$ leaves the cell, and $Na^+$ enters the cell. Other ions, like $Ca^{2+}$ and $Cl^-$, are also involved. The exchange is large enough to shift the membrane potential, but normally considered so small that it does not affect the ionic concentrations. This approach is good under many circumstances. Still, it is shown that rapid firing of action potentials will change the extracellular concentrations, and that concentration gradients will build up over time. The concentration gradients are three-dimensional, and depends on the geometry of the *brain tissue*.  The cortex is a layered structure, where different kinds of neurons are located at different depths. It is possible to give stimuli that make responses in one kind of neuron. If one layer got the same behaviour everywhere, a one-dimensional model is suitable. Also: we might not have enough information construct a three-dimensional model, so a one-dimensional might be equally good. 

All ionic species whose concentrations varies with cortical depth should be represented in the electrodiffusive model. In Halnes2016 they included four ion species, namely $K^+$, $Na^+$, $Ca^{2+}$ and an unspecified anion $X^-$ in their simulations.

\subsubsection{Previously published exctracellular concentration recordings}
In my work, I rely completely on previously recorded ion concentrations. I present the main contributes here in the theory section, because I think their findings have an impact on who to model the initial concentrations. 

\begin{itemize}
\item Dietzel et al. have measured extracellular concentrations of $K^+$, $Na^+$ and $Ca^{2+}$ during repetitive stimulation and stimulus-induced self-sustained neuronal afterdis-
charges (SAD) in the sensimotori cortex of cats. They have not been able to measure more than two ion species simultaneously. In their experiments, they have found that the changes in $[Cl^-]$ were slow, and often not observable before after the stimulation period. Simultaneous measurements of $[K^+]$ and $[Na^+]$ at a depth of 1000 $\mu$m revealed that the increase in $K^+$ had the same time course as the decrease in $Na^+$ for the first 10 s. At higher cortical levels, there was a fast $Ca^{2+}$ decrease which inferred with the measurements, but when this were corrected for they found reason to believe that there was a 1:1 K+/Na+ exchange at all cortical levels during the stimulation period. Dietzel et al. present many data sets, of which he $Na^+$ and $Ca^{2+}$ measurements have the most measuring points. 

\item Nicholson et al. have measured extracellular $K^+$ and $Ca^{2+}$ in the cerebellar cortex of cats. The stimulation had a duration of 30 s, for frequencies 5, 10 and 20 Hz. They found that that the major [K+] changes occur superficially but that some [K+], increase persists at all levels. This is expected, since local surface stimulation excites a superficial beam of parallel fibres and Purkinje cell synapses. The [Ca2+] changes were more localized to the superficial regions. Nicholson et al. outlines the difference in the diffusion constant as a possible explanation.

\item Cordingley and Somjen have measured extracellular K+ in the neocortex and spinal cord of cats, and studied the half-decay time of the K+ transients. The observed half-decay times of
[K+] transients were more than a hundred times shorter than those calculated for
diffusion either in spinal cord or in cortex. 

\item Halnes et al. have simulated a network of 10 pyramidal neurons, and kept track of the ionic output. Figure is the ionic output after 42 s of activity. 
\end{itemize}


\begin{figure}[!tbp]
  \centering
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{dietzel.png}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{finfugl.jpg}
  \end{minipage}
    \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{nicholson.png}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{cordingley_somjen.png}
  \end{minipage}
  \caption{Previously published extracellular concentration recordings A) $Na^+$ and $Ca^{2+}$ profile recorded from sensimotori cortex of cats by Dietzel et al. Stimulation: 15-20 Hz for 10 s. B) $[K^+]$ and $Ca^{2+}$  recorded from cerebellar cortex of cats by Nicholson et al. Frequencies associated with profiles marked on upper abscissa. Stimulation time is 30 s. Maximum deviation from baseline was reached after 10 s, solid dots and squares/the outer curves. C) ionic output simulated by Halnes et al., using 10 pyramidal neurons. D) $K^+$ recorded from visual cortex of cats by Cordingley and Somejen. Stimulation time 1 s. Both surface stimulation and VPL(ventral posterolateral nucleus) stimulation.
}
  \label{fig:data sets}
\end{figure} 


\subsubsection{Initial concentration profiles based on recorded ionic concentrations}
As we saw in the previous section, I have not succeeded in finding spatial profiles with more than two simultaneously measured ion species. This calls for assumptions about the other ion species. Primarily I have to decide how many ion species should be included. Na+ and K+ are the ion species which experience the largest concentration shifts, because these ions are the key ions in the generation of the action potentials. The model have to include Na+ and K+. Cl- is the most abundant anion in the extracellular space, and it is necessary in order to make an electroneutral bulk solution. Ca2+ is an important signalling ion, and its relative concentration variations are large, but the concentration variations are approximately a tenth of the Na+ and K+ variations (see figure \ref{fig:data sets}. Not all the data sets contain information about $Ca^{2+}$, and I think, as a first move, it is safe to neglect it. What I want to do, is to find a way to construct the initial profiles of K+, Na+ and Cl- that can be applied to the data sets of *section*. For their estimates, Gratiy et al. used the data set of figure \ref{fig:data sets} D. They assumed that $\Delta [K^+] + \Delta [Na^+] = 0$ to make a depth profile for $Na^+$. An implicit assumption is that Cl- is at baseline all the time, and that Na+ and K+ two ion species were considered the sole contributors to the diffusive currents. This assumption finds further support in Dietzel1982. , who found that during the stimulation period, the 1:1 Na+/K+ exchange in all cortical layers. This was further backed up by measurements of [Cl-]. The dynamics of Cl- were slower, the increase in Cl- was firstly observed after the stimulation period. It makes sense using baseline $Cl^-$ as an initial $Cl^-$ profile. 
To sum it up: if our measurements are limited to only K+ or Na+, the most reasonable assumption about the other ions are:
 $$\Delta [K^+] =  -\Delta [Na^+] \quad \land \quad \Delta [Cl^-] =0$$ 

\subsection{Spreading depression}
The concentration gradients and the concentration dynamics presented in the previous section are due to intense, but still not abnormal neural activity. A phenomenon where much larger concentration gradients and where diffusion is believed to play a role, is spreading depression. Spreading Depression (SD) is a slowly propagating wave of intense but transient
regional depolarization of neurons (and glia and perhaps all cells) (Ayata2015). Spreading depression is a positive feedback loop, of which I will here try to give a rough outline. A sudden opening of nonselective large-conductance cation channels lets $Na^+$ flow into the neuron, and $K^+$ flow out. This results in a depolarization of the neuronal membrane (according to the goldman equation), together with a drop in the extracellular potential ($V_m=V_i-V_o$, $\Phi = V_o - V_{\infty}$). The extracellular $K^+$ clearance mechanisms become overloaded, and massive $K^+$ efflux raises $[K^+]$ from $ \propto 3$ mM at resting state
to over 30 â€“50 mM, and sometimes as
high as 80 mM,. The massive rise in $K^+$ is sufficient to depolarize the neighbouring cells and is the critical factor mediating the contiguous spread of
the wave (Ataya 2015). (this is contradictory to herreras, who found that the initial delta v0 occurs before the rise in K+)(if the $[K^+]_o$ in the goldman equation is much larger, the membrane potential will be more positive. )
The drop in the extracellular potential is only partly accounted for by the depolarization of the membrane. It is speculated that a diffusion potential might contribute (Herreras). 


Because spreading depression is associated with extremely high, but transient, extracellular $K^+$ concentrations, we can expect large concentration gradients as well. It is possible that concentration gradients of this scale results in a diffusion potential that has a substantial impact on the LFP. During spreading depression the neuronal dynamics differs from the dynamics described by Dietzel1982, because the ordinary voltage gated channels are replaced by others. Depolarization also inhibits generation of action potential. The concentration shifts are approximately $\Delta [Na^+] = -2\Delta [K^+]$ and $\Delta [Cl^-] = -\Delta[K^+]$(HerrerasSomjen  and Ayata). The value of $\Delta [K^+]$ depends on the baseline concentration. The $K^+$ levels are back to baseline after approximately a minute. 


Because complete membrane depolarization precludes action potentials or synaptic transmission, SD is accompanied by suppression of all
spontaneous or evoked electrical activity in that region (Ayata2015).Lasting up to a minute or more in otherwise normal tissue .

\subsection{Electrodiffusion in the extracellular space}
In the precious section, I argued that a one-dimensional model is a good approach. 
In one dimension, our protagonist (equation \ref{eq:el-diff}) takes the shape of 

\begin{equation}\label{KNP}
\frac{\partial c_k}{\partial t}= \frac{D_k}{\lambda_n^2} \frac{\partial^2 c_k}{\partial x^2}+\frac{D_k z_k}{\lambda_n^2 \Psi} \frac{\partial }{\partial x}  \bigg(c_k \frac{\partial \Phi}{\partial x} \bigg)
\end{equation}
Solving equation \ref{KNP} involves two solutions: $\Phi (x,t)$ and $c_k(x,t)$. This calls for one more relation between $\Phi$ and $c_k$. The Kirchoff -- Nernst -- Planck formalism combines the Nernst -- Planck equation with Kirchoff's law for current conservation. 
The net current $I$ is the sum of all the ion fluxes:
\begin{equation}
I = \sum_{k}z_k FJ_k = -\frac{F}{\lambda_n}\sum_k z_k D_k  \frac{\partial c_k}{ \partial x} - \frac{F}{\lambda_n \Psi}\sum_k z_k^2D_k c_k \frac{\partial \Phi}{\partial x}
\end{equation}
In my model, there will be no current sources or sinks; the net current is zero. 
$\Phi$ is equal for all ion species. With $I =0$, we get an expression for $ \frac{\partial}{\partial x} \Phi$:

\begin{equation}\label{dPhi dx}
\frac{\partial}{\partial x} \Phi = \frac{-\Psi \sum_k z_k D_k \frac{\partial}{\partial x} c_k}{\sum_k z_k^2 D_k c_k}
\end{equation}

Equation \ref{dPhi dx} can be inserted into equation \ref{KNP} to find $c_k(x,t)$, and it can be used to find the diffusion potential itself. The main focus of this work is on the diffusion potential $\Phi$, but the solution $c_k(x,t)$ is useful for comparing the numerical solution to the analytical one.

\subsection{The power spectrum density}
The power spectrum density (PSD) is a concept from signal analysis. It is a representation of the frequency components of a signal. The PSD is obtained with the help of the Fourier transform, which is a transform from the time domain to the frequency domain. *something about the Fourier transform* The PSD is the squared amplitude per frequency. In experiments where the local field potential is measured, the measurements are often presented as PSDs, because this representation makes it possible to spot the dominating frequencies of the signal. *something more about why we look at the PSD rather than the signal itself. *
\subsection{An analytical solution of a simplified system}
\subsubsection{Joint diffusion coefficient}\label{joint diffusion}
Let's go back to the system with $Na^+$ and $Cl^-$, or two other ion species 1 and 2 where $z_1 = -z_2$ and the diffusion coefficients are $D_1$ and $D_2$. The system is prepared so that the concentrations are equal: $c_1 = c_2$, but not homogeneous. The ions must diffuse with the same speed to maintain electroneutrality. To make this happen, an electrical field which slows down the fastest ion and speeds up the slowest one, emerge.  We want to find the joint diffusion coefficient $D$, that is, the diffusion coefficient the ions both should have had in order to diffuse with this speed without the presence of a field. In other words, we want to find $D$ so that it satisfies:
\begin{equation}
D_1 \frac{\partial c}{\partial x} + \frac{D_1 c}{\Psi}\frac{\partial \Phi}{\partial x} = D\frac{\partial c}{\partial x}
\end{equation} 
\begin{equation}\label{eq:D}
D = D_1 + D_1 \frac{c}{\Psi}\frac{\frac{\partial \Phi}{\partial x}}{\frac{\partial c}{\partial x}}
\end{equation}
The zero current requirement gives :
\begin{equation}
D_1 \frac{\partial c}{\partial x} + \frac{D_1 c}{\Psi}\frac{\partial \Phi}{\partial x} - D_2 \frac{\partial c}{\partial x} + \frac{D_2 c}{\Psi}\frac{\partial \Phi}{\partial x} = 0
\end{equation}
Rearrange it so that left hand side is expressed in terms of $D_1$ and $D_2$:
\begin{equation}
\frac{D_2 - D_1}{D_1 + D_2} = \frac{c}{\Psi}\frac{\frac{\partial \Phi}{\partial x}}{\frac{\partial c}{\partial x}}
\end{equation}
Inserted into \ref{eq:D}: 
\begin{equation}
D = D_1 +D_1 \frac{D_2 - D_1}{D_1 + D_2} = \frac{D_1(D_1 + D_2)+D_1(D_2-D_1)}{D_1+D_2} = \frac{2D_1D_2}{D_1+D_2}
\end{equation}
The two ions with opposite valence and diffusion coefficients $D_1$ and $D_2$ will in the presence of the diffusion potential move in the same way as two ions with the same diffusion coefficient $D$, not subjected to a potential. 


\subsubsection{The analytical solution to the one dimensional diffusion equation}\label{analytical solution}
In this work, I will only work with one-dimensional concentration gradients (why? see section \ref{one dimensional}). Then, equation \ref{eq:diff} takes the shape of
\begin{equation}\label{eq:1D diff}
\frac{\partial c}{\partial t} = D\frac{\partial^2 c}{\partial x^2}
\end{equation}
I want to solve it for homogeneous boundary conditions, 
$$c(0,t) = c(L,t)=0 \quad t>0$$ where $L$ is the length of the system. I use the separation of variables technique. 
\begin{equation*}
c(x,t) = X(x)T(t)
\end{equation*}
\begin{equation*}
\frac{\partial c}{\partial t} = T'X
\end{equation*}
\begin{equation*}
\frac{\partial^2 c}{\partial x^2} = TX''
\end{equation*}
Inserted into the equation \ref{eq:1D diff}

\begin{equation*}
T'X  = DTX''\implies \frac{T'}{DT} = \frac{X''}{X} =\mathsf{ constant}
\end{equation*}
Let the constant be $-\lambda ^2$. We then have two separate equations:
\begin{equation*}
T' + \lambda^2 T = 0 \implies T=e^{-\lambda^2 tD}
\end{equation*}

\begin{equation*}
X'' + \lambda^2X = 0 \implies X=A \sin \lambda x + B\cos \lambda x
\end{equation*}
The boundary condition $c(0,t) = 0$ requires $B=0$, while the boundary condition $c(L,t)=0$ requires that $\lambda$ is a multiple of $\pi$: $\lambda_k = k\pi /L$, where $k = 1,2,3,...$. 
We now have the solution $c(x,t)=X(x)T(t)$
\begin{equation}\label{eq:c(x,t)}
c(x,t) = \sum_k A_k \sin \frac{k \pi x}{L}\cdot e^{-Dk^2\pi^2 t /L^2}
\end{equation}
where $A_k$ are the Fourier coefficients of the initial concentration.


\section{Methods}

\subsection{Numerical scheme for solving the 1D Nernst -- Planck equation}\label{Solving the equation}
There is no analytical solution of equation \ref{KNP}, and we must reach for a numerical solution. The numerical solution involves the discretization of $c_k$. To simplify the notation, I skip the index $k$ for the ion species. Then the ionic concentration expressed with the discretized variables $x_i = x_0 +i \Delta x$ and $t_j = t_0 + j \Delta t$ is 
$$c_i^j = c(x_i, t_j)$$

For the approximation of the derivatives, there are many schemes to choose from. The straight-forward way is to use the Euler Forward approximation for the time derivative of $c_k$.
$$\frac{\partial c}{\partial t} \approx \frac{c^{j+1}-c^j}{\Delta t}$$
Then, the current state is used to find the state at the next time step, which means that I for every time step can calculate the value of the right-hand side of equation \ref{KNP}, and add it to the current solution. 

To make every part of the system electroneutral, it is important to that the derivatives on the right-hand side use the same integration points. I found (with the help of Andreas) that this is the case with the following approximations for the spatial derivatives. 
$$\frac{\partial^2 c}{\partial x^2} \approx \frac{c_{i+1}-2c_i+c_{i-1}}{(\Delta x)^2}$$
And 
$$\frac{\partial }{\partial x}  \bigg(c \frac{\partial \Phi}{\partial x} \bigg)\approx \frac{1}{\Delta x}\bigg( c_{i+1/2} \big(\frac{\partial \Phi}{\partial x}\big)_{i+1/2} -  c_{i-1/2} \big(\frac{\partial \Phi}{\partial x}\big)_{i-1/2} \bigg) $$
where 
$$c_{i+ 1/2} = \frac{c_{i+1}+ c_i}{2}$$
and by using a central- half point disretization of equation 5
\begin{equation}\label{eq:gradPhi}
\big(\frac{\partial \Phi}{\partial x}\big)_{i+1/2} = \frac{-\Psi \sum_k z_k D_k (\frac{\partial c}{\partial x})_{k,i+1/2}}{\sum_k z_k^2 D_k c_{k,i+1/2}}= \frac{-\Psi \sum_k z_k D_k (c_{k,i+1}-c_{k,i})/\Delta x }{\sum_k z_k^2 D_k (c_{k,i+1}+c_{k,i})/2}
\end{equation}
Now, we have a discretization of equation \ref{KNP} where $c^{j+1}$ is totally determined by $c^j$ and $\Phi^j$, and where the same integration points, $c_{i-1}, c_i, c_{i+1}$ are used for both spatial derivatives.  

I have chosen to work with dimensionless variables. With $$\Phi = \Psi\Phi' = RT/F\Phi' = 0.0267V \Phi'$$ and $$\alpha_k = \frac{\Delta t D_k}{(\Delta x)^2 \lambda_n^2}$$ the concentration of ion species $k$ at time $t_{j+1}$ is:
\begin{multline}\label{eq:c_i+1}
 c_i^{j+1}= c_i^j + \alpha(c_{i+1}^j-2c_i^j+c_{i-1}^j)\\ + \alpha z\Delta x \bigg(\frac{c_{i+1}^j+c_i^j}{2} \big(\frac{\partial \Phi'}{\partial x}\big)_{i+1/2}^j-\frac{c_{i}^j+c_{i-1}^j}{2} \big(\frac{\partial \Phi'}{\partial x}\big)_{i+1/2}^j\bigg)
\end{multline}
The solution I find by this method, is $c(x,t)$. What I really want to find is $\Phi(x,t)$. I have used the trapezoid rule to integrate $v(x) =\partial \Phi / \partial x$.
\begin{equation}
\int_x^{x+\Delta x}v(x') dx'  \approx \Delta x ( v(x+\Delta x) + v(x) )/2
\end{equation}

\subsection{Implementation of the numerical scheme}
The solver \texttt{solveEquation(Ions, lambda\_n, N\_t, delta\_t, N, delta\_x)} was implemented in Python.  \texttt{Ions} is a list containing instances of the class \texttt{Ion}. The attributes of an \texttt{Ion} ion are three concentration vectors: one that store the initial concentration profile of the ion, one for temporary storing newly calculated concentration profiles, and one which is the ion concentration profile at that time step. \texttt{c} is used to calculate \texttt{grad\_phi}, according to equation \ref{eq:gradPhi}. \texttt{grad\_phi} is calculated at the half-points. This means that the \texttt{grad\_phi} is one element shorter than \texttt{c}.   Grad phi, together with c, is used to calculate c new. \texttt{solveEquation} calls the function \texttt{integrate(v,xmin,xmax)}, which integrates \texttt{grad\_phi}. The scheme used is the trapezoid rule, where the boundaries are zero at both sides. \texttt{integrate} returns the integrated vector for the interior points (edges not included). $\Phi(x)$ is stored in an array, which is returned by the function \texttt{solveEquation}. Phi is then a dimensionless quantity, and must be multiplied by $\Psi$. Equation \ref{eq:c_i+1} is scaled so that any unit will work for the concentrations, but I have chosen to work with SI units.  



$x_{max} =N_x \Delta x$ and $t_{final} = N_t \Delta t$, where $x_{max}$ is the cortical depth in meters and $t_{final}$ is the total simulation time.
\subsection{Initial conditions}\label{Initial conditions: Ion concentration profiles from experiments}
The solution presented in section \ref{Solving the equation} requires initial conditions. The initial potential is calculated from the initial concentrations, and the initial concentrations are used to calculate the concentration at the next time step. In *section* I presented some arguments for the $1\!:\!1\ K^+\!/Na^+$ relation. Other simplifications of the ion balance might be equally good. To investigate what impact the initial ion balance has on the diffusion potential, I have tested some scenarios where only the initial $[K^+]$ is known, and we have to make an educated guess about the other ions.
\begin{itemize}
	\item[]\underline{Scenario 1}: The rise in $K^+$ is balanced with an equal decrease in $Na^+$
	  $$\Delta [K^+] = -\Delta [Na^+] \quad \land \quad \Delta [Cl^-] =0$$
	\item[]\underline{Scenario 2}:  The rise in $K^+$ is shared between $Na^+$ and $Cl^-$
	$$\Delta [K^+] = -\frac{1}{2} \Delta [Na^+] +\frac{1}{2} \Delta [Cl^-] $$ 
		\item[]\underline{Scenario 3}:  The rise in $K^+$ is balanced with an equal increase in $Cl^-$
	  $$\Delta [K^+] = \Delta [Cl^-] \quad \land \quad \Delta [Na^+] =0$$
	  \item[]\underline{Scenario 4}:  In studies of spading depression *reference*, I has been shown that the rise in $Na^+$ is even larger than the rise in $K^+$, and that the charge is balanced by $Cl^-$. The ratios between the ion species makes the foundation for the 4. scenario:
	$$\Delta [K^+] = -2 \Delta [Na^+] \quad \land \quad \Delta [K^+] =  -\Delta [Cl^-] =0$$ 
	\item[]\underline{Scenario 5}: In some experiments, the concentrations of two different ion species are known. For this reason I have included a 5th scenario. Here, I assume that both $[K^+]$ and $[Na^+]$ are known, and make an assumption about $Cl^-$
	$$\Delta [K^+] + \Delta [Na^+] = \Delta[Cl^-] $$
\end{itemize}

How am I to evaluate which scenario describes the ionic concentration in the extracellular space best? I have used the $[K^+]$ from the Halnes simulations to construct the initial ion concentration profiles for the five scenarios, and calculated the diffusion potential for each of them. I have plotted the potential at $t=0$ together with the diffusion potential resulting for the full Halnes model. 
\subsubsection{Initial concentration profiles}

\subsubsection{Spreading depression}

\subsubsection{The two-ion system}
The two-ion system is a constructed system; it is not related to processes in the brain. I have used it to make sure that the solver works properly, by comparing the purely diffusive system of *section*\ to the two-ion system of *section*. I used the simplest initial condition i could think of: 
$$c(x,0) =c_0 +  \Delta c_{max}\sin{\frac{\pi x}{L}}$$
Then, there is no need for a Fourier expansion, as $k=1$ and $A_1 = \Delta c_{max}$ satisfies \ref{eq:c(x,t)}, and the solution is
\begin{equation*}
c(x,t) =c_0 + \Delta c_{max} \sin \frac{ \pi x}{L}\cdot e^{-D\pi^2 t /L^2}
\end{equation*}


\subsection{The solution and its power spectrum density}
A presentation of the diffusion potential is found in section \ref{diffusion potentials}, where I have used a contour plot of $\Phi(x,t)$ to illustrate the development of the potential with time. The potential, and the powers of the potential are not the same for all cortical depths.
To find the power spectrum density of the diffusion potential, I used \texttt{periodogram}  from the \texttt{signal} class in Python. The input of \texttt{periodogram} is the sampling frequency $f_s = 1/\Delta t$ of the signal. It returns a vector of frequencies, and the PSD of the signal.

 I wanted to look at the largest possible effect of the diffusion potential on the total extracellular potential. For this purpose, I have calculated the PSD of the potential for all depths $x$. I made a function which compares these PSDs, returning largest mean PSD and the depth where it was found. The PSDs of the diffusions potentials are presented in a log-log plot in section \ref{diffusion potentials}.

\subsection{The quality of the solver}
How good is the solver I have implemented? One important test is the electroneutrality test. I have implemented a unit test to check that the sum 
$$\frac{\sum_k z_k c_k}{\sum_k z_k^2 c_k}$$
does not exceed a certain value. Further testing is difficult, as there is no analytical solution to equation \ref{KNP}. I have used the equivalence of the purely diffusive system and the electrodiffusive two-ion system described in section \ref{joint diffusion} to investigate the stability and the precision of the solver. I compared the numerical solution of a system with two ions of opposite valence but equal diffusion coefficients to a system with different diffusion coefficients. 
Then, I found the difference between the analytical and the numerical solution for the purely diffusive system for various combinations of $\Delta x$ and $\Delta t$, and I used the difference as an error estimate. The results are presented in section \ref{numerical vs analytical}. 

\section{Results}
\subsection{Error analysis}\label{numerical vs analytical}

\begin{figure}
  \includegraphics[width=\linewidth]{two_ions.png}
  \caption{The diffusion potential of a system with two ions, Cl- and Na+. Initial concentrations: 0.15 + .003*sin(pix/L).$\Delta x = 0.01$mm, $\Delta t = 0.01 $s. }
  \label{fig:two_ions}
\end{figure}

I have used the numerical solver to simulate the sodium-chloride system of section \ref{electrodiffusion} with  the initial conditions the initial conditions $c_{Na}(x,0)=c_{Cl}(x,0)=150+3\cdot \sin(\pi x/L)$ (measured in mM). 

Then, I simulated a system with two ion species which both have the same diffusion coefficient $D=2D_{Na}D_{Cl}/(D_{Na}+D_{Cl})$. The initial conditions were the same as in the just mentioned sodium-chloride system. When I compared the solution $c(x,t)$ of this system to the solution of the sodium-chloride system, I found that they were equal, down to numerical precision. In this simulation, the potential I found was zero at all depths for all times, and it is reasonable to call it a purely diffusive system. This is a confirmation of what was stated in section \ref{joint diffusion}: the concentrations of the electrodiffusive two-ion system (the sodium-chloride system) behave exactly like the concentrations of the purely diffusive two-ion system. In the following, I have employed this attribute to do an error analysis. 

I have compared the analytical solution of section \ref{analytical solution} to the numerical solution of the sodium-chloride system. I tried with different values for the initial maximum concentration deviation, $\Delta c_{max}$, and I found that the difference was proportional to the maximum concentration deviation. To study the error, I calculated
\begin{equation}
\frac{c(x=0.5,t)_{numerical}-c(x=0.5,t)_{analytical}}{\Delta c_{max}}
\end{equation}
for various combinations of $\Delta t$ and $\Delta x$, see table \ref{tab:error}. All simulations have $t = 100$ s and $L=1$ mm. The error decays as $(\Delta x)^2$, which is in line whit the error of the  approximations I used for the spatial derivatives. The time derivative approximation has an error of $O(\Delta t)$, but the solution does not improve with smaller $\Delta t$. This has to do with *something about the instability of the euler forward scheme*.
For $\Delta x$ as small an $0.001$ mm, the system became unstable with my choices of $\Delta t$. In my implementation of the numerical scheme, I need an array with dimensions $N_x \times N_t$. For $\Delta x = .001$ mm and $\Delta t = 0.0001$s this corresponds to a $100\times 1000 000$ array, which is larger than *ordinary python matrices*. 
Since there is nothing to gain with a high time resolution, I have used $\Delta t = 0.01$ s and $\Delta x = 0.001$ mm for all simulations presented in the following. This gives an error of order $10^{-5}$. 
\begin{table}[h!]
  \centering
  \caption{The difference between the numerical and analytical solution. length of the system: 1 mm, time: 100 s. Maximum deviation for baseline concentration: .003 M.  }
  \label{tab:error}
  \begin{tabular}{l||l|l|l|l}
$\Delta t$/$\Delta x$ & 0.1 mm & 0.01 mm & 0.001 mm  \\
\hline
0.1 s & 0.003426 &  unstable & unstable \\
0.01 s & 0.003546 & 1.757e-05  & unstable \\
0.001 s & 0.003558 & 2.713e-05 & unstable \\
0.0001 s & 0.003559& 2.808e-05 & ? \\

 \end{tabular}
\end{table}

So far, we have only looked at the solution for the concentrations, and seen that $c(x,t) =c_0 + \Delta c_{max} \sin \frac{ \pi x}{L}\cdot e^{-D\pi^2 t /L^2}$ is a solution of the sodium-chloride system. What about the solution for the potential, $\Phi(x,t)$ ? In figure \ref{fig:two_ions} I have plotted $\Phi(x,t)$ for $t=0,20,40,60,80$ s. It has the same sine shape as the concentration. The amplitude at $t=0$ is $\Phi_{max} = 0.1095$ mV. With $\tau = L^2/D\pi^2 = 158.2$ s, I calculated $\Phi_{max} \cdot e^{-t/{\tau}}$ and compared it to the solution $\Phi(L/2,t)$, see table \ref{tab:error2}. An exponentially decaying concentration gives an exponentially decaying potential. This insight will come in handy in section \ref{exponential decay}, but we must keep in mind that the exponential concentration decay is a property of the very simplified sodium-chloride system. 

\begin{table}[h!]
  \centering
  \caption{The numerical solution $\Phi(x,t)$ and an exponentially decaying function with $\tau = 158.2$ s at the midpoint of the system for $t=0,20,40,60,80$ s. }
  \label{tab:error2}
  \begin{tabular}{l||l|l|l|l}
 & t=20 & t=40 & t=60 & t=80\\
 \hline
$\Phi(L/2,t)$  & 0.0966 mV &  0.0852 mV & 0.0751 mV & 0.0663 mV\\
\hline
$\Phi_{max} \cdot e^{-t/{\tau}}$  & 0.0965 mV & 0.0851 mV & 0.0750 mV & 0.0661 mV\\


 \end{tabular}
\end{table}


\subsection{The $\Delta [K^+] = - \Delta [Na^+] $ assumtion}\label{The K/Na assumtion}

\begin{figure}
  \includegraphics[width=\linewidth]{init_c_scenarioes.png}
  \caption{The diffusion potential resulting from different models for the initial ion concentration profiles}
  \label{fig:init_c_scenarioes}
\end{figure}
The error analysis of the previous section gives me confidence that my numerical scheme does indeed simulate the diffusion potential. The next challenge is to find initial conditions that in agreement with biological systems. As discussed in *section*, the recordings of the ionic concentrations do not contain information about more than two ion species, and for my simulations to be realistic I need at least three. The data from the Halnes2016 simulations contains four ion species, and I have used this data set as a proxy.

The blue line (with legend 0) in figure \ref{fig:init_c_scenarioes} is the diffusion potential at $t=0$ s calculated from the "full model" with data from the Halnes2016. The other lines are the diffusion potentials at $t=0$ s for the five scenarios described in section \ref{Initial conditions: Ion concentration profiles from experiments}.  The shape of the potential and of the full model and of scenario 5 (with known $[Na^+]$ and $[K^+]$) are almost the same for all cortical depths. This indicates that it is sufficient to know the concentrations of these two ion species to get a satisfying model of the diffusion potential. For all scenarios, the potential is largest at a cortical depth of approximately 1.2 mm. This correspond to the soma compartment of the neurons in Halnes simulations. The soma region has the largest ionic exchange with the extracellular space *can I find literature about this*, hence the large diffusion potential. For cortical depths between 0.8 and 1.3 mm, scenario 1 also seems give a good agreement with the full model. In this region, the ionic exchange consist mainly of $K^+$ and $Na^+$. In the higher regions, the difference is larger, because the $K^+$ efflux from the neurons in this region is small. The potential of scenario 2 has the same shape as that of scenario 1, but a smaller amplitude. The smaller amplitude can be explained by the diffusion coefficients. The diffusion coefficients of $K^+$ ($D_K = 1.96\cdot 10^{-9}$) and $Cl^-$ ($D_{Cl} = 2.03\cdot 10^{-9}$) are much closer to each other than $D_K$ and $D_{Na}$ ($D_{Na} = 1.33\cdot 10^{-9}$).  The difference in diffusion constants is what makes the diffusion potential in the first place. When half of the $Na^+ $ is replaced with $Cl^-$, half of the $K^+$ is neutralized by $Cl^-$, effectively halving the initial concentration deviation. The result is that scenario 2 has poorer fit than scenario 1, for all cortical depths. In scenario 3, we see the consequences of the very small difference between $D_{Cl}$ and $D_K$. Here, the diffusion potential is 12\% of the full model potential. A peculiarity of this scenario is that the potential is positive. The explanation lays again in the diffusion coefficients. $D_{Cl}$ is larger $D_K$, so that the negative $Cl^-$ escapes faster, leaving a positive charge in the soma region. In the scenario where the initial $[Na^+]$ differs the most from baseline, the diffusion potential is largest. In the scenario where the initial $[Na^+]$ is at baseline, $K^+$ and $Cl^-$ diffuse with almost the same speed, and the potential required for maintaining electroneutrality is much lower. 


Of the three scenarios based only on a known $K^+$ concentration (scenario 1,2 and 3), scenario 1 is the most suitable for populations of neurons with ionic output similar to that of the Halens model.

Scenario 4 stands out. The amplitude of the diffusion potential in the soma region is more that twice the amplitude from the full model. This is caused by the initial $\Delta [Na^+]$ , which is the double of the initial $\Delta[K^+]$. In the case of spreading depression, the 1:1 Na+/K+ model underestimates the diffusion potential. 

The main concern of this thesis is not the spatial shape of the diffusion potential, but its temporal aspects, represented by its PSD. The amplitude of the potential vary across the cortical depth. I have chosen to let the depth at which the mean PSD is largest to be representative. In this case (with $t_{final}=100s$ and the total depth of the system $x_{max} = 1.3$ mm), the largest mean PSD was at at depth of $1.18$ mm. The PSDs are presented in figure \ref{fig:psd_scenarios}.  According to figure \ref{fig:init_c_scenarioes}, we should expect the largest difference between the full model and scenario 1 seems to be at a depth of $0.2$ mm. In figure \ref{fig:psd_scenarios} I have included the PSDs at this depth. 

\begin{figure}[!tbp]
  \centering
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{psd_scenarios_soma.png}

  \end{minipage}
\hfill
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{psd_scenarios_dendrite.png}

  \end{minipage}
  \label{fig:psd_scenarios}
  \caption{Left: The PSDs of the diffusion potentials at cortical depth $x=1.18$ mm. The spreading depression scenario (5) has larger powers than the scenarios. Scenario 1 and scenario 5 gives a diffusion potential with the same powers as the full model (0). 
  Right: The diffusion potential of scenario 1 have smaller powers that the full model. (the purple line is hidden under the brown line) }

\end{figure} 

At the depth where the mean PSDs have their maximum, there difference between the full model and scenario 1 is small. At the depth were the difference in potentials is largest, there is a difference in the PSDs as well. Still, all the powers are smaller at this depth. When I am looking for the maximum possible effect of the diffusion potential on the local field potential, scenario 1 gives a good estimate. 
\subsection{The diffusion potentials calculated from $K^+$ profiles from four different experiments}\label{diffusion potentials}
\subsubsection{The shape of the initial concentration profile and of the diffusion potential}

\begin{figure}[!tbp]
  \centering
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{Dietzel1982_delta_c.png}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{Halnes2016_delta_c.png}
  \end{minipage}
    \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{Nicholson1987_delta_c.png}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{Gratiy2017_delta_c.png}
  \end{minipage}
  \caption{Initial ion concentration profiles. Black dots represent the original data points. Upper left: $Na^+$ profile recorded from sensimotori cortex of cats by Dietzel et al. Lower left: $[K^+]$  recorded from cerebellar cortex of cats by Nicholson et al. Upper right:  $K^+$ simulated by Halnes et al., using 10 pyramidal neurons.Lower right: $K^+$ recorded from visual cortex of cats by Cordingley and Somejen }
  \label{fig:initial concentrations}
\end{figure} 
Of the three scenarios for the initial concentration profiles, I think scenario 1 is the best, and this is the model I have used for building the initial concentration profiles. Figure \ref{fig:initial concentrations} shows the initial concentration profiles, together with the data points I have used to construct the profiles. The data points are taken from figure \ref{fig:data sets}, and are marked as black dots. Figure \ref{fig:contours} shows contour plots of the resulting diffusion potentials. Like in the sodium-chloride system, the cortical depth of where the largest potential is found seems to correspond with the depth at which the initial concentration had the largest deviation from baseline. Also, a sharp peak in initial concentration gives a sharp peak in the potential at $t=0$ (like in Nicholson and Halnes), while a smoother initial concentration profile gives a smoother potential. The potentials decay with time, but the way it decays depends on the shape of the initial concentration profile. In the experiments with a relatively smooth initial concentration, like Diezel and Gratiy, after the first 10 s or so, the potential seems to be just decaying, indicating that an exponential decay might be a reasonable model for the diffusion potential. In Nicholson and Halnes, the potential is also "spreading out". This means that assuming an exponential decay of the potential will not be correct if there is a sharp peak in the concentration gradient. 

\begin{figure}[!tbp]
  \centering
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{Dietzel1982Phi_of_t.png}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{Halnes2016Phi_of_t.png}
  \end{minipage}
    \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{Nicholson1987Phi_of_t.png}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{Gratiy2017Phi_of_t.png}
  \end{minipage}
  \caption{The diffusion potentials calculated from the initial concentration profiles. The shape of the initial concentration profile is reflected in the shape of the diffusion potential. NB: note that the colorbar is not the same.}
  \label{fig:contours}
\end{figure} 




\begin{figure}
  \includegraphics[width=\linewidth]{PSD.png}
  \caption{The PSD of the diffusion potentials. For frequencies between 0.1 and 100 Hz, all PSDs follow a $1/f^2$ power law. In Dietzel1982, the largest initial concentration deviation was recorded, and this produces the largest powers.}
  \label{fig:PSD}
\end{figure}




\begin{table}[h!]
  \centering
  \caption{The power of the diffusion potential at 1 Hz. The power is higher when the largest initial deviation from baseline concentration is higher. The largest powers are found at the depth where the magnitude of the diffusion potential is large.}
  \label{tab:psd_magnitude}
  \begin{tabular}{l||l|l|l|l}
model & log(PSD) & $\Delta [K]_{max}$ & depth \\
\hline
Halnes & -4.89 & 6  & 1.18 mm\\
Dietzel & -5.21 & 7.5 & 0.08 mm \\
Nicholson & -5.32 & 4.4 & 0.10 mm \\
Gratiy &-6.63 & 1.89 & 0.88 mm \\
 \end{tabular}
\end{table}





\subsubsection{The PSD of the diffusion potential}
Figure \ref{fig:PSD} shows a log-log plot of the PSDs of the diffusion potentials. The PSDs in figure \ref{fig:PSD} are the PSD of the potential at the depth where the mean power was largest. The power of the potentials are not the same for the four data sets. The variations are related to the maximum initial $\Delta [K^+]$, see table \ref{tab:psd_magnitude}. The rule seems to be that the larger $\Delta [K^+]_{max}$, the larger are the powers of the signal.  To give further support to this idea, I returned to equation \ref{dPhi dx}. Because the change in $c_k$ is slow, the variations in $\sum_k z_k^2 D_k c_k$ are slow, and we can say that 

\begin{equation}
 \frac{\partial \Phi}{\partial x}  \propto { \sum_k z_k D_k \frac{\partial c_k}{\partial x} }
\end{equation}
which leads to a relation between $\Delta \Phi$ and $\Delta c_k$:
\begin{equation}\label{delta phi}
 \Delta \Phi \propto \sum z_k D_k \Delta c_k
\end{equation}
where $\Delta \Phi $ is the difference between potential at the boundary and some point inside the system, and $\Delta c_k $ is the deviation from baseline concentration for ion species $k$ . Because I have used a model where $\Delta [K^+]$ mirrors $\Delta [Na^+]$, and $\Delta [Cl^-] =0$, the maximum deviation from baseline will be at the same depth for all ion species $k$. 

Equation \ref{delta phi} can by no means be used to calculate $\Phi$, as the simplification $\sum_k z_k^2 D_k c_k =\ const.$ is not true, and should only be regarded as a justification of the intuitive idea that the model with the largest $\Delta [K^+]$ produces the largest potentials and the PSDs with highest powers. 


Figure \ref{fig:contours} shows the concentration profiles I used as initial conditions. The concentration profiles have very different shapes, which is reflected in at which depth the largest power is found, see table \ref{tab:psd_magnitude}. The rule seems to be that the largest powers are found in the compartment where the initial $\Delta [K^+]$ has its peak, which is in agreement with relation \ref{delta phi}. The shape of the initial concentration profile does not seem to affect the PSD of the diffusion potential. This could be an artefact from the assumption of the ion balance, or it could be a characteristic feature of diffusion itself. In the next section, I will try to dig further into this matter. 


For frequencies larger than 0.1 Hz, the lines of figure \ref{diffusion potentials} appear  parallel. I calculated 

$$\frac{\Delta\log_{10}PSD}{\Delta \log_{10}f}$$
in the interval between 0.1 and 10 Hz, and I found this value to be -2.0 (with two leading digits) for all data sets. The diffusion potential seems to follow a $1/f^2$ power law. As a consequence, a LFP where diffusion plays an important role might display the same power law.  *theoretical back-up*







\subsubsection{The PSD of the diffusion potential compared to PSDs of local field potentials}

\begin{figure}
  \includegraphics[width=\linewidth]{PSD_Gratiy.png}
  \caption{The local field potential and the diffusion potential. LFP from visual cortex in cats.}
  \label{fig:PSD_Gratiy}
\end{figure}

The results from Halnes2016 and Gratiy2017 gave reason to suspect that the diffusion potential is of the same or higher power than the power measured local field potentials for frequencies smaller than 1 Hz. I have plotted the PSD from the Dietzel data(which gave the highest powers) together with the PSD of the local field potential used by Gratiy et al. to produce the CDS in *figure* . From figure \ref{fig:PSD_Gratiy} it is clear that the diffusion potential has lower power than the LFP  - for all frequencies. The diffusion potential is too small to compete with all the other slow potentials in the extracellular space. Here, more data would be useful. Also, how does the power relate to the animal species, and to where in the brain the signal is measured?

\subsection{The time constant of the  $\Delta [K^+]$ decay}\label{exponential decay}
So far, we have explained the ion transport in the extracellular space by the joint effort of electrical migration and diffusion. This is not the case in living systems. Many mechanisms contribute to the maintenance of low concentration gradients, such as ionic pumps and uptake mechanisms. We can therefore expect the gradients to have a more rapid decay. It would be a time-consuming task to model all these processes. Instead, I have made a model which allows the concentration gradients to decay exponentially. The model is based on the 1:1 Na/K scenario, and the concentration dynamics are:
$$
c_{K}(x,t) = c_{K}^0 +\Delta c_{max}(x) \cdot e^{-t/\tau}
$$
$$
c_{Na}(x,t) = c_{Na}^0 -\Delta c_{max}(x) \cdot e^{-t/\tau}
$$
$$
c_{Cl}(x,t) = c_{Cl}^0
$$
where $c_{K}^0$, $c_{Na}^0$ and $c_{Cl}^0$ are the baseline concentrations and $\Delta c_{max} (x)$ is the initial $K^+$ deviation from baseline.  Then, I have used 


\begin{equation*}
\frac{\partial}{\partial x} \Phi = \frac{-\Psi \sum_k z_k D_k \frac{\partial}{\partial x} c_k}{\sum_k z_k^2 D_k c_k}
\end{equation*}
(equation \ref{eq:gradPhi}) to calculate the momentary diffusion potential at every time step. The initial concentrations used are those of Gratiy2017. I have used time constants $\tau = 1,10,20,50, 150, 250$ s. From the time series of momentary diffusion potentials I calculated the PSDs in the same fashion as described in *section*. The results are shown in figure \ref{fig:exponential_decay}, together with the PSD of the electrodiffusive diffusion potential. 

\begin{figure}
  \includegraphics[width=\linewidth]{exponential_decay.png}
  \caption{The local field potential and the diffusion potential. }
  \label{fig:exponential_decay}
\end{figure}

The time series of the momentary diffusion potentials follow approximately the same $1/f^2$ power law as we have seen in previous sections. This indicates that the modelling of the diffusion potential itself might not be necessary, as exponentially decaying concentration gradients exhibits the same properties when it comes to the PSD of the potential. The important part is to find the correct time constant. The time constant of the decay of the diffusion potential is close to 250 s. This is larger than the time constant of the two-ion system (which had $\tau = 153$ s), but of the same order of magnitude.

From experiments, we know that the concentration gradients decay much faster. How does a small time constant affect the PSD?. Figure \ref{fig:exponential_decay} suggest that the time constant affect the powers. The smaller time constant, the higher powers, but only up to a limit. It seems like $\tau \approx 20 $ s, gives the largest powers. With an even smaller time constant, the slope of the PSD is approaching zero for the lowest frequencies. This is not shocking news: a fast-varying signal should yield lower powers for the lowest frequencies. What is less intuitive, is that the powers does not appear to be higher for any frequency. A further investigation revealed that the powers are marginally higher of the $\tau = 1$ s scenario than of the $\tau = 20 $s scenario for frequencies larger than 1 Hz.

Does a faster decay of the concentration gradient produce PSDs that are able to compete with the other contribution to the LFP? No. Why does Gratiy et al. find a crossing point? 

\subsection{Spreading depression}

As we saw in section \ref{diffusion potentials}, the magnitude of the diffusion potential, and thereby its power, is determined by the initial concentration deviation. Concentrations measured in normal neuronal activity were not high enough to get at powers as large as those we see in measurements of local field potentials. But in some extreme situations, like spreading depression, the concentration deviation gets much larger. I have simulated the diffusion potential with the initial $K^+$ profile from HerrerasSomjen. For $Na^+$ and $Cl^-$ I used $\Delta [Na^+] = -2\Delta [K^+]$ and $\Delta [Cl^-] = -\Delta[K^+]$. The baseline concentrations were respectively 3 mM, 150 mM and 153 mM. This gave a maximum diffusion potential of -4.2 mV. This is similar to what was estimated by HerrerasSomjen with the help of the Goldman equation. Because the excessive $K^+$ is cleared out in about a minute (Ataya), I also simulated the diffusion potential from exponentially decaying concentrations, with time constants $\tau = 10, 30, 60 $ s. The PSDs of these potentials, together with the PSD from the electrodiffusive model, are presented in figure \ref{fig:sd}. I have included the same LFPs as in figure \ref{fig:PSD_Gratiy} for comparison. 
Now, the diffusion potential is of the same powers as the measured  LFP, and diffusion might contribute to the total potential. I have not seen any LFPs recorded during spreading depression. It might be so that these LFPs have larger powers for the low frequencies than what is observed during normal activity. 

\begin{figure}
  \includegraphics[width=\linewidth]{sd.png}
  \caption{The local field potential and the diffusion potential. }
  \label{fig:sd}
\end{figure}

During SD: DC potential shift. This might be a reason for diffusion not affecting the PSD. Diffusion does give rise to a potential, which shifts the local ESC potential. But the very slow change in this potential might be the reason for it not having any impact on the PSD.

\section{Discussion}

\section{References}

\begin{thebibliography}{1}
\bibitem{lecturenotes} 
Herreras, O. \& Somjen, G.G: Analysis of potential shifts associated with recurrent spreading
depression and prolonged unstable spreading depression induced by
microdialysis of elevated K + in hippocampus of anesthetized rats,
Brain Research, 610, 1993
\\\texttt{http:}
\end{thebibliography}

\end{document}